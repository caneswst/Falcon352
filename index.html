<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>傲翔2025丙組戰術板</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;700&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            display: flex;
            flex-direction: column;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #e8ecef, #f5f7fa);
            color: #333;
            overflow-x: hidden;
            min-height: 100vh;
        }
        #header {
            text-align: center;
            padding: 2vh 0;
            background: linear-gradient(90deg, #4682b4, #2e8b57);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        #header h1 {
            font-family: 'Bebas+Neue', cursive;
            font-size: clamp(24px, 5vw, 36px);
            margin: 0;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        .container {
            display: flex;
            flex-wrap: nowrap;
            padding: 1vw;
            max-width: 100%;
            margin: 0 auto;
            gap: 1vw;
            flex-grow: 1;
            align-items: stretch;
        }
        #pitch-container {
            flex: 0 0 25%;
            position: relative;
            background: url('https://raw.githubusercontent.com/caneswst/Falcon352/refs/heads/main/football_pitch.jpg') no-repeat center;
            background-size: cover;
            min-height: 200px;
            aspect-ratio: 3 / 5;
            border: 2px solid #4682b4;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(70, 130, 180, 0.2);
            background-color: #2e8b57;
        }
        #pitch-error {
            display: none;
            color: red;
            text-align: center;
            padding: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
.player {
    position: absolute;
    width: clamp(25px, 3.5vw, 40px);
    height: clamp(25px, 3.5vw, 40px);
    background: #4682b4;
    border-radius: 50%;
    color: #fff;
    text-align: center;
    line-height: clamp(25px, 3.5vw, 40px);
    cursor: move;
    font-size: clamp(8px, 1.5vw, 14px);
    transition: transform 0.3s, box-shadow 0.3s;
    transform: translate(-50%, -50%);
    user-select: none;
    z-index: 10; /* 確保圖形在前景 */
}
        .player:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 0 8px rgba(70, 130, 180, 0.6);
        }
.football {
    position: absolute;
    width: clamp(20px, 2.5vw, 30px);
    height: clamp(20px, 2.5vw, 30px);
    background: url('https://github.com/caneswst/Falcon352/blob/b72546b3fd6cb74b4e24c295d7ca9c73e8b94e7b/football.png') no-repeat center;
    background-size: contain;
    cursor: move;
    transform: translate(-50%, -50%);
    user-select: none;
    z-index: 5; /* 足球在球員下方 */
}
        .football:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }
        .stats {
            position: absolute;
            top: calc(100% + 2px);
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: clamp(6px, 1vw, 10px);
            white-space: nowrap;
            background: rgba(0, 0, 0, 0.7);
            padding: 2px 4px;
            border-radius: 3px;
            pointer-events: none;
        }
        #left-panel, #subs-container, #right-panel {
            flex: 1 1 18%;
            padding: 1vw;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            min-width: 200px;
        }
        select {
            width: 100%;
            padding: clamp(4px, 1vw, 6px);
            margin-bottom: clamp(6px, 1vw, 8px);
            border-radius: 5px;
            background: #fff;
            color: #333;
            border: 1px solid #4682b4;
            font-size: clamp(10px, 1.5vw, 12px);
        }
        h2, h3 {
            color: #4682b4;
            font-family: 'Bebas+Neue', cursive;
            margin: clamp(4px, 1vw, 5px) 0;
            font-size: clamp(16px, 2vw, 20px);
        }
        .position-info {
            display: none;
            line-height: 1.5;
            background: rgba(70, 130, 180, 0.1);
            padding: clamp(6px, 1vw, 8px);
            border-radius: 5px;
            margin-bottom: clamp(6px, 1vw, 8px);
        }
        .position-info p {
            margin: clamp(3px, 0.5vw, 4px) 0;
            font-size: clamp(10px, 1.5vw, 12px);
        }
        .position-info strong {
            color: #2e8b57;
        }
        #formation-select {
            width: 100%;
            padding: clamp(6px, 1vw, 8px);
            margin-bottom: clamp(8px, 1.5vw, 10px);
            font-size: clamp(12px, 1.8vw, 14px);
            background: #4682b4;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        #formation-select:hover {
            background: #2e8b57;
        }
        .export-import-btn {
            width: 100%;
            padding: clamp(6px, 1vw, 8px);
            margin: clamp(4px, 0.5vw, 6px) 0;
            font-size: clamp(12px, 1.8vw, 14px);
            background: #2e8b57;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .export-import-btn:hover {
            background: #4682b4;
        }
        #import-file {
            display: none;
        }
        .sub-player {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px;
            background: rgba(255, 255, 255, 0.9);
            margin: 2px 0;
            border-radius: 3px;
        }
        .sub-player span {
            margin-right: 5px;
        }
        .sub-stats {
            display: flex;
            align-items: center;
            font-size: clamp(8px, 1.2vw, 12px);
            color: #333;
        }
        .sub-stats input {
            width: 40px;
            padding: 2px;
            margin-left: 5px;
            border: 1px solid #4682b4;
            border-radius: 3px;
            font-size: clamp(8px, 1vw, 10px);
            text-align: center;
        }
        @media (max-width: 900px) {
            .container {
                flex-wrap: wrap;
            }
            #pitch-container {
                flex: 0 0 70%;
            }
            #left-panel, #subs-container, #right-panel {
                flex: 1 1 15%;
            }
        }
        @media (max-width: 600px) {
            .container {
                flex-direction: column;
                padding: 2vw;
            }
            #pitch-container {
                width: 100%;
                min-height: 50vh;
                max-height: 400px;
            }
            #left-panel, #subs-container, #right-panel {
                width: 100%;
                min-height: 30vh;
                margin-top: 2vw;
            }
            #left-panel { order: 2; }
            #subs-container { order: 3; }
            #right-panel { order: 1; }
            .player {
                width: 6vw;
                height: 6vw;
                line-height: 6vw;
                font-size: 2vw;
            }
            .football {
                width: 5vw;
                height: 5vw;
            }
            .stats {
                font-size: 1.5vw;
            }
            .sub-stats input {
                width: 30px;
            }
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>傲翔2025丙組戰術板</h1>
    </div>
    <div class="container">
        <div id="left-panel">
            <h2>陣容選擇</h2>
            <label>選擇陣型:</label>
            <select id="formation-select">
                <option value="442-defensive">4-4-2 防守陣</option>
                <option value="352-defensive">3-5-2 防守陣</option>
                <option value="451-defensive">4-5-1 防守陣</option>
                <option value="4231-defensive">4-2-3-1 防守陣</option>
            </select>
            <div id="positions-container"></div>
            <button class="export-import-btn" onclick="exportFormation()">匯出陣容</button>
            <button class="export-import-btn" onclick="document.getElementById('import-file').click()">匯入陣容</button>
            <input type="file" id="import-file" accept=".json" onchange="importFormation(event)">
        </div>
        <div id="subs-container">
            <h3>後備球員</h3>
            <div id="subs-list"></div>
        </div>
        <div id="pitch-container">
            <div id="pitch-error" style="display: none;">
                無法加載足球場圖片，請檢查網路或圖片路徑。
            </div>
        </div>
        <div id="right-panel">
            <h2>請點選位置顯示戰術要求</h2>
            <div id="position-details"></div>
        </div>
    </div>

    <script>
        // 球員名單與統計數據，初始值為 0
        const players = {
            '新': { appearances: 0, goals: 0, assists: 0 },
            '禮': { appearances: 0, goals: 0, assists: 0 },
            '東': { appearances: 0, goals: 0, assists: 0 },
            'Vasco': { appearances: 0, goals: 0, assists: 0 },
            'Alex': { appearances: 0, goals: 0, assists: 0 },
            '光': { appearances: 0, goals: 0, assists: 0 },
            '航': { appearances: 0, goals: 0, assists: 0 },
            'Xander': { appearances: 0, goals: 0, assists: 0 },
            'Nate': { appearances: 0, goals: 0, assists: 0 },
            '軍C': { appearances: 0, goals: 0, assists: 0 },
            '俊': { appearances: 0, goals: 0, assists: 0 },
            'Joe': { appearances: 0, goals: 0, assists: 0 },
            '杰': { appearances: 0, goals: 0, assists: 0 },
            '銳': { appearances: 0, goals: 0, assists: 0 },
            'Mike': { appearances: 0, goals: 0, assists: 0 },
            'Dan': { appearances: 0, goals: 0, assists: 0 },
            '銘': { appearances: 0, goals: 0, assists: 0 },
            '達': { appearances: 0, goals: 0, assists: 0 },
            'Hugo': { appearances: 0, goals: 0, assists: 0 },
            'Ivan': { appearances: 0, goals: 0, assists: 0 },
            '業': { appearances: 0, goals: 0, assists: 0 },
            '曹': { appearances: 0, goals: 0, assists: 0 },
            '恒': { appearances: 0, goals: 0, assists: 0 },
            '甘': { appearances: 0, goals: 0, assists: 0 }
        };

        const formations = {
            '442-defensive': {
                positions: ['gk', 'lb', 'lcb', 'rcb', 'rb', 'lm', 'lcm', 'rcm', 'rm', 'lst', 'rst'],
                layout: {
                    'gk': { left: '50%', top: '90%' },
                    'lb': { left: '20%', top: '70%' },
                    'lcb': { left: '40%', top: '70%' },
                    'rcb': { left: '60%', top: '70%' },
                    'rb': { left: '80%', top: '70%' },
                    'lm': { left: '20%', top: '45%' },
                    'lcm': { left: '40%', top: '45%' },
                    'rcm': { left: '60%', top: '45%' },
                    'rm': { left: '80%', top: '45%' },
                    'lst': { left: '40%', top: '20%' },
                    'rst': { left: '60%', top: '20%' }
                },
                // details 內容保持不變，已省略以縮短程式碼
                details: formations['442-defensive'].details
            },
            '352-defensive': {
                positions: ['gk', 'lcb', 'cb', 'rcb', 'lwb', 'ldm', 'rdm', 'rwb', 'am', 'lst', 'rst'],
                layout: {
                    'gk': { left: '50%', top: '90%' },
                    'lcb': { left: '30%', top: '70%' },
                    'cb': { left: '50%', top: '70%' },
                    'rcb': { left: '70%', top: '70%' },
                    'lwb': { left: '20%', top: '50%' },
                    'ldm': { left: '40%', top: '55%' },
                    'rdm': { left: '60%', top: '55%' },
                    'rwb': { left: '80%', top: '50%' },
                    'am': { left: '50%', top: '35%' },
                    'lst': { left: '35%', top: '20%' },
                    'rst': { left: '65%', top: '20%' }
                },
                details: formations['352-defensive'].details
            },
            '451-defensive': {
                positions: ['gk', 'lb', 'lcb', 'rcb', 'rb', 'lm', 'lcm', 'cdm', 'rcm', 'rm', 'st'],
                layout: {
                    'gk': { left: '50%', top: '90%' },
                    'lb': { left: '20%', top: '70%' },
                    'lcb': { left: '40%', top: '70%' },
                    'rcb': { left: '60%', top: '70%' },
                    'rb': { left: '80%', top: '70%' },
                    'lm': { left: '20%', top: '40%' },
                    'lcm': { left: '30%', top: '50%' },
                    'cdm': { left: '50%', top: '50%' },
                    'rcm': { left: '70%', top: '50%' },
                    'rm': { left: '80%', top: '40%' },
                    'st': { left: '50%', top: '25%' }
                },
                details: formations['451-defensive'].details
            },
            '4231-defensive': {
                positions: ['gk', 'lb', 'lcb', 'rcb', 'rb', 'ldm', 'rdm', 'lam', 'cam', 'ram', 'st'],
                layout: {
                    'gk': { left: '50%', top: '90%' },
                    'lb': { left: '20%', top: '70%' },
                    'lcb': { left: '40%', top: '70%' },
                    'rcb': { left: '60%', top: '70%' },
                    'rb': { left: '80%', top: '70%' },
                    'ldm': { left: '40%', top: '55%' },
                    'rdm': { left: '60%', top: '55%' },
                    'lam': { left: '20%', top: '50%' },
                    'cam': { left: '50%', top: '45%' },
                    'ram': { left: '80%', top: '50%' },
                    'st': { left: '50%', top: '30%' }
                },
                details: formations['4231-defensive'].details
            }
        };

        let selectedPlayersByFormation = {
            '442-defensive': {},
            '352-defensive': {},
            '451-defensive': {},
            '4231-defensive': {}
        };
        let playerPositionsByFormation = {
            '442-defensive': {},
            '352-defensive': {},
            '451-defensive': {},
            '4231-defensive': {}
        };
        let footballPosition = { left: '50%', top: '50%' };
        let currentFormation = '442-defensive';

        // 檢查足球場圖片是否加載成功
        function checkPitchImage() {
            const img = new Image();
            img.src = 'https://raw.githubusercontent.com/caneswst/Falcon352/refs/heads/main/football_pitch.jpg';
            img.onload = () => {
                document.getElementById('pitch-error').style.display = 'none';
                document.getElementById('pitch-container').style.backgroundImage = "url('https://raw.githubusercontent.com/caneswst/Falcon352/refs/heads/main/football_pitch.jpg')";
            };
            img.onerror = () => {
                document.getElementById('pitch-error').style.display = 'block';
                document.getElementById('pitch-container').style.backgroundImage = 'none';
            };
        }

        // 初始化陣型選擇
        function initFormationSelect() {
            const formationSelect = document.getElementById('formation-select');
            formationSelect.value = '442-defensive';
            formationSelect.onchange = () => {
                currentFormation = formationSelect.value;
                updateFormation();
                updatePitchAndSubs();
            };
            loadSavedSelections();
            updateFormation();
            checkPitchImage();
        }

// 更新陣型相關內容
function updateFormation() {
    const formation = formations[currentFormation];
    const positionsContainer = document.getElementById('positions-container');
    const pitchContainer = document.getElementById('pitch-container');
    const positionDetails = document.getElementById('position-details');

    // 清空並重新生成位置選擇框
    positionsContainer.innerHTML = '';
    formation.positions.forEach(pos => {
        const label = document.createElement('label');
        label.textContent = formation.details[pos].name + ':';
        const select = document.createElement('select');
        select.id = pos;
        select.innerHTML = '<option value="">選擇球員</option>' + 
            Object.keys(players).map(p => `<option value="${p}">${p}</option>`).join('');
        select.onchange = () => {
            selectedPlayersByFormation[currentFormation][pos] = select.value;
            updatePitchAndSubs(); // 立即更新戰術板
        };
        if (selectedPlayersByFormation[currentFormation][pos]) {
            select.value = selectedPlayersByFormation[currentFormation][pos];
        }
        positionsContainer.appendChild(label);
        positionsContainer.appendChild(select);
    });

    // 重置戰術板內容
    pitchContainer.innerHTML = '<div id="pitch-error" style="display: none;">無法加載足球場圖片，請檢查網路或圖片路徑。</div>';

    // 添加球員圖示
    formation.positions.forEach(pos => {
        const playerDiv = document.createElement('div');
        playerDiv.className = 'player';
        playerDiv.id = `${pos}-player`;
        playerDiv.dataset.position = pos;
        const savedPos = playerPositionsByFormation[currentFormation][pos] || formation.layout[pos];
        playerDiv.style.left = savedPos.left;
        playerDiv.style.top = savedPos.top;
        const selectedPlayer = selectedPlayersByFormation[currentFormation][pos] || '';
        playerDiv.textContent = selectedPlayer || pos.toUpperCase();

        const statsDiv = document.createElement('div');
        statsDiv.className = 'stats';
        statsDiv.id = `${pos}-stats`;
        playerDiv.appendChild(statsDiv);

        playerDiv.onclick = (e) => {
            if (!playerDiv.isDragging) showPositionDetails(pos);
        };
        makeDraggable(playerDiv);
        pitchContainer.appendChild(playerDiv);
    });

    // 添加足球圖示
    const footballDiv = document.createElement('div');
    footballDiv.className = 'football';
    footballDiv.id = 'football';
    footballDiv.style.left = footballPosition.left;
    footballDiv.style.top = footballPosition.top;
    makeDraggable(footballDiv, true);
    pitchContainer.appendChild(footballDiv);

    // 更新戰術要求
    positionDetails.innerHTML = '';
    formation.positions.forEach(pos => {
        const info = formation.details[pos];
        positionDetails.innerHTML += `
            <div id="${pos}-info" class="position-info">
                <h3>${info.name}</h3>
                <p><strong>戰術要求:</strong> ${info.tactics}</p>
                <p><strong>技術要求:</strong> ${info.tech}</p>
                <p><strong>進攻時位置要求:</strong> ${info.off}</p>
                <p><strong>防守時位置要求:</strong> ${info.def}</p>
                <p><strong>代表球員:</strong> ${info.example}</p>
            </div>
        `;
    });

    if (formation.positions.length > 0) {
        showPositionDetails(formation.positions[0]);
    }
    updatePitchAndSubs();
}

// 更新戰術板和後備名單
function updatePitchAndSubs() {
    const formation = formations[currentFormation];
    const selected = new Set();

    // 更新戰術板上的球員名稱
    formation.positions.forEach(pos => {
        const select = document.getElementById(pos);
        const playerDiv = document.getElementById(`${pos}-player`);
        const statsDiv = document.getElementById(`${pos}-stats`);
        if (select && playerDiv && statsDiv) {
            const selectedPlayer = select.value;
            playerDiv.textContent = selectedPlayer || pos.toUpperCase();
            selectedPlayersByFormation[currentFormation][pos] = selectedPlayer;
            statsDiv.textContent = selectedPlayer ? `${players[selectedPlayer].appearances}-${players[selectedPlayer].goals}-${players[selectedPlayer].assists}` : '';
            if (selectedPlayer) selected.add(selectedPlayer);
        }
    });

    // 更新後備名單
    const subsList = document.getElementById('subs-list');
    if (subsList) {
        const subs = Object.keys(players).filter(p => !selected.has(p));
        subsList.innerHTML = subs.map(p => {
            const stats = players[p];
            return `
                <div class="sub-player">
                    <span>${p}</span>
                    <span class="sub-stats">
                        出:<input type="number" min="0" value="${stats.appearances}" onchange="updateStats('${p}', 'appearances', this.value)">
                        球:<input type="number" min="0" value="${stats.goals}" onchange="updateStats('${p}', 'goals', this.value)">
                        助:<input type="number" min="0" value="${stats.assists}" onchange="updateStats('${p}', 'assists', this.value)">
                    </span>
                </div>
            `;
        }).join('');
    }

    localStorage.setItem('selectedPlayersByFormation', JSON.stringify(selectedPlayersByFormation));
    localStorage.setItem('currentFormation', currentFormation);
    localStorage.setItem('playersStats', JSON.stringify(players));
}

        // 更新統計數據
        function updateStats(playerName, statType, value) {
            if (players[playerName]) {
                const numValue = parseInt(value) || 0;
                players[playerName][statType] = numValue;
                localStorage.setItem('playersStats', JSON.stringify(players));
                updatePitchAndSubs();
            }
        }

        // 載入上次保存的選擇和統計數據
        function loadSavedSelections() {
            const savedFormation = localStorage.getItem('currentFormation');
            const savedPlayers = localStorage.getItem('selectedPlayersByFormation');
            const savedStats = localStorage.getItem('playersStats');
            const savedPositions = localStorage.getItem('playerPositionsByFormation');
            const savedFootballPos = localStorage.getItem('footballPosition');
            if (savedFormation) {
                currentFormation = savedFormation;
                document.getElementById('formation-select').value = savedFormation;
            }
            if (savedPlayers) {
                selectedPlayersByFormation = JSON.parse(savedPlayers);
            }
            if (savedStats) {
                Object.assign(players, JSON.parse(savedStats));
            }
            if (savedPositions) {
                playerPositionsByFormation = JSON.parse(savedPositions);
            }
            if (savedFootballPos) {
                footballPosition = JSON.parse(savedFootballPos);
            }
            Object.keys(formations).forEach(formation => {
                if (!selectedPlayersByFormation[formation]) {
                    selectedPlayersByFormation[formation] = {};
                }
                if (!playerPositionsByFormation[formation]) {
                    playerPositionsByFormation[formation] = {};
                }
            });
        }

        // 顯示位置詳情
        function showPositionDetails(pos) {
            document.querySelectorAll('.position-info').forEach(info => info.style.display = 'none');
            const infoDiv = document.getElementById(pos + '-info');
            if (infoDiv) infoDiv.style.display = 'block';
        }

        // 匯出陣容功能
        function exportFormation() {
            const data = {
                currentFormation: currentFormation,
                selectedPlayersByFormation: selectedPlayersByFormation,
                playerPositionsByFormation: playerPositionsByFormation,
                footballPosition: footballPosition,
                players: players
            };
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'formation.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 匯入陣容功能
        function importFormation(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.currentFormation && data.selectedPlayersByFormation) {
                        currentFormation = data.currentFormation;
                        selectedPlayersByFormation = data.selectedPlayersByFormation;
                        playerPositionsByFormation = data.playerPositionsByFormation || playerPositionsByFormation;
                        footballPosition = data.footballPosition || footballPosition;
                        if (data.players) {
                            Object.assign(players, data.players);
                        }
                        Object.keys(formations).forEach(formation => {
                            if (!selectedPlayersByFormation[formation]) {
                                selectedPlayersByFormation[formation] = {};
                            }
                            if (!playerPositionsByFormation[formation]) {
                                playerPositionsByFormation[formation] = {};
                            }
                        });
                        document.getElementById('formation-select').value = currentFormation;
                        updateFormation();
                        updatePitchAndSubs();
                        localStorage.setItem('currentFormation', currentFormation);
                        localStorage.setItem('selectedPlayersByFormation', JSON.stringify(selectedPlayersByFormation));
                        localStorage.setItem('playerPositionsByFormation', JSON.stringify(playerPositionsByFormation));
                        localStorage.setItem('footballPosition', JSON.stringify(footballPosition));
                        localStorage.setItem('playersStats', JSON.stringify(players));
                        alert('陣容已成功匯入！');
                    } else {
                        alert('匯入的檔案格式不正確！');
                    }
                } catch (err) {
                    alert('無法解析匯入的檔案，請確保檔案格式正確！');
                }
            };
            reader.readAsText(file);
        }

        window.onload = () => {
            initFormationSelect();
        };
    </script>
</body>
</html>
